---
title: Rancher
weight: 30
---

> Make sure the 
> [prerequisites for Ondat]({{< ref "docs/prerequisites/_index.md" >}}) are
> satisfied before proceeding.

> Ondat transparently supports Rancher deployments on CentOS, RHEL,
> Debian, Ubuntu or RancherOS (CSI is not supported on RancherOS) and can
> support other Linux distributions as detailed on the [System Configuration
> page]({{< ref "docs/prerequisites/systemconfiguration.md" >}}) if the
> appropriate kernel modules are available.


&nbsp;

{{< tabs tabTotal="2" tabID="1" tabHREFPrefix="" tabName1="Catalog" tabName2="Advanced" >}}
{{% tab firstTab="true" tabRef="catalog" %}}

# Rancher Catalog Install

Ondat is a Certified application in the [Rancher
Catalog](https://rancher.com/docs/rancher/v2.x/en/catalog/). You can install
Ondat using the Rancher application install.

1. Select the `System` project of your cluster

    ![install-1](/images/rancher-ui-green-bubbles/rancher-1.png)

1. Select the `Apps` tab and click `Launch`
    ![install-2](/images/rancher-ui-green-bubbles/rancher-2.png)

1. Search for Ondat and click on the App
    ![install-3](/images/rancher-ui-green-bubbles/rancher-3.png)

1. Define the Ondat cluster installation

    > A generic configuration for Ondat is preset using the default values in
    > the form. The values in the form can be changed to customize the
    > installation. To customize the installation further, set `Install Ondat
    > Cluster` to false and use a [yaml definition for the StorageOSCluster
    > Custom
    > Resource](/docs/install/rancher/install/rancher-catalog#custom-resource-definition).

    &nbsp;

    The following options are exposed by the form to allow some simple
    customization of the Ondat installation.
    - [Cluster Operator]({{< ref "docs/reference/cluster-operator/_index.md" >}}) namespace
    : The Kubernetes namespace where the Ondat Cluster Operator controller
    and other resources will be created.
    - Container Images
    : By default images are pulled from DockerHub, you can specify the image URLs
    when using private registries.
    - Conditional bootstrap of Ondat 
    : Controls the automatic deployment of Ondat after installing the
    Cluster Operator. If set to `false`, the Operator will be created, but the
    Custom Resource will not be applied to the cluster. Launch the operator and
    proceed to the section [Custom Resource
    definition](#custom-resource-definition). For more information check the
    Operator [documentation]({{< ref
    "docs/reference/cluster-operator/configuration.md" >}}) and [CR
    examples]({{< ref "docs/reference/cluster-operator/examples.md" >}}).
    - Ondat namespace
    : The Kubernetes namespace where Ondat will be installed. Installing
    into the `kube-system` namespace will add Ondat to a priority class to
    ensure high priority resource allocation. Installing Ondat with the
    priority class prevents Ondat from being evicted during periods of
    resource contention.
    - Username/Password
    : Default Username and Password for the admin account to be created at
    Ondat bootstrap. A random password will be generated by leaving the
    field empty or clicking the `Generate` button.
    - Key-value store [setup]({{< ref "docs/operations/external-etcd/_index.md" >}})
    : Connection and configuration details for an external Etcd cluster.
    Ondat can use an external key-value store to hold configuration.
    Settings such as external etcd with TLS termination are available.
    - Node Selectors and Tolerations
    : Control placement of Ondat DaemonSet Pods. Ondat will only be installed
    on the selected nodes. Can be used in conjunction with tolerations.

    &nbsp;

    ![install-4](/images/rancher-ui-green-bubbles/rancher-4.png)
    ![install-5](/images/rancher-ui-green-bubbles/rancher-5.png)


1. Verify the cluster bootstrap has successfully completed

    ![install-6](/images/rancher-ui-green-bubbles/rancher-6.png)


&nbsp;

## Custom Resource definition

If `Install Ondat Cluster` was set to `false`, Ondat will not be
bootstrapped automatically. After the Ondat Operator is installed, you can
now create a Custom Resource that describes the Ondat cluster.

1. Select the `System Workloads` and `Import YAML`
    ![install-7](/images/rancher-ui-green-bubbles/rancher-7.png)

1. Create the `Secret` and `CustomResource`
    ![install-8](/images/rancher-ui-green-bubbles/rancher-8.png)


    This is an example.

    ```bash
    apiVersion: v1
    kind: Secret
    metadata:
      name: "storageos-api"
      namespace: "storageos-operator"
      labels:
        app: "storageos"
    type: "kubernetes.io/storageos"
    data:
      # echo -n '<secret>' | base64
      apiUsername: c3RvcmFnZW9z # Define your own user and password
      apiPassword: c3RvcmFnZW9z
    ---
    apiVersion: "storageos.com/v1"
    kind: StorageOSCluster
    metadata:
      name: "storageos"
    spec:
      k8sDistro: "rancher"
      namespace: "kube-system"
      secretRefName: "storageos-api" # Reference from the Secret created in the previous step
      secretRefNamespace: "storageos-operator"  # Namespace of the Secret
      csi:
        enable: true
        deploymentStrategy: "deployment"
      images:
        nodeContainer: "storageos/node:{{ site.latest_node_version }}" # Ondat version
    #  kvBackend:
    #    address: 'storageos-etcd-client.etcd:2379' # Example address, change for your etcd endpoint
    #    backend: 'etcd'
      sharedDir: '/var/lib/kubelet/plugins/kubernetes.io~storageos' # Needed when Kubelet runs as a container
      resources:
        requests:
          memory: "512Mi"
      nodeSelectorTerms:
        - matchExpressions:
          - key: "node-role.kubernetes.io/worker"
            operator: In
            values:
            - "true"
    ```

    > Additional `spec` parameters are available on the [Cluster Operator
    > configuration]({%link _docs/reference/cluster-operator/configuration.md %}) page.

    > You can find more examples such as deployments referencing a external
    > etcd kv store for Ondat in the [Cluster Operator examples]({{< ref "docs/reference/cluster-operator/examples.md" >}}) page.

{{% /tab %}}
{{% tab tabRef="advanced" %}}

# Advanced installation

This installation procedure is available in case the default method does not
meet your requirements. The following procedure requires more steps to complete
in comparison to the default procedure and requires adjustment of more
installation parameters.

{{% operator-header %}}
{{% operator-install cmd="kubectl" %}}
{{% operator-secret %}}
{{% operator-cr cmd="kubectl" sched_version="1.17" platforms="rancher" %}}

{{% /tab %}}
{{< /tabs >}}

{{% include "content/first-volume.md" %}}
